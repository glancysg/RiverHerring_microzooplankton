---
title: "microzoo_analysis"
author: "Sarah Glancy"
date: "3/19/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

#Overview of steps to this projects data compiling and analysis. 
#1- add data to github- this includes the fish growth data, microzoo counts, ambient environment data and larval gut data (gut data not generated as of 2021-05-06)

```{r}

library(readxl)

bin_counts <- read_excel("C:/Users/Sarah/Desktop/WHOI/Microzooplankton/binCounts_20210506.xlsx")
View(bin_counts)

library(readr)

Otolith_Growth_Rate_4DO <- read_csv("C:/Users/Sarah/Desktop/WHOI/Microzooplankton/Otolith_Growth_Rate_4DO.csv")

Otolith_Growth_Rate_All <- read_csv("C:/Users/Sarah/Desktop/WHOI/Microzooplankton/Otolith_Growth_Rate_all.csv")

```

## load in older files supplied by Justin (will not be chnaged) from google drive. 

#DC lesson on sheet management/organization
#https://datacarpentry.org/spreadsheet-ecology-lesson/

```{r}
library(tidyverse)
library(googlesheets4)
library(googledrive)

# Google Sheet is the input
myurl <- "https://docs.google.com/spreadsheets/d/1EJuErt2DDZDtzXWHWAbuwS9ptBaA1lkPDLeeiBQg-KU/edit?usp=sharing" # url for googlesheet
gs4_auth() # manual authorization thru web browser
Fish_collection_date_relate <- read_sheet(myurl) # manual authorization thru web browser


gs4_get(Fish_collection_date_relate)

```

##before joining tables, change date to day of year, prepresented in #lubridate function as %j. Is 1 = Jan 1st etc. 

##try to change to year-month-day with simple function, will it work with 6 digit date?
```{r}
library(lubridate)
ymd(150520)
```

##Yes!!

## now need to change all dates in 4 pages to this format. 
## alternative, can I go from 6 digit date directly to year-day?
     

#Use libridate function yday() 

```{r}
  yday(Fish_collection_date_relate$Date)
```
  ##does not seem to work directly.
  
```{r}

ymd(Fish_collection_date_relate$Date)
```
  # that worked (but i hid it becasue it was huge), now use mutate() to add a column with this new date information to the end of the df. 
  
```{r}
Fish_collection_ymd_date <- mutate(Fish_collection_date_relate, 
       ymd_date = ymd(Fish_collection_date_relate$Date))
```
  ##yay, worked again, now change to year-day
  
```{r}

 transmute(Fish_collection_ymd_date, 
          year_day = yday(ymd_date))
```
  Yay again!
  
  ## Question: do joins though tidyverse require the joining column to have the same column name? I guess yes, should I just change the column name to match before attempting?
  
```{r}
Fish_collection_3.0 <- Fish_collection_ymd_date %>%
  rename( Fish_Num = Oto_Num) %>% 
  mutate( year_day = yday(Fish_collection_ymd_date$ymd_date))
  

```
  
## That worked!!
## need to figure out how to save a change to my df without renaming (ie creating ## a bunch of dfs) it every time? 

-----------------------------------------------

##Attempting a join now that the col namesa re the same. full join. 

```{r}
Fish_Otolith_Join <- full_join(Fish_collection_3.0, Otolith_Growth_Rate_all, by = "Fish_Num")

```

##Okay next step is to get dates with the current bin counts from EP. 

```{r}
Date_bin_relational <- read_excel("C:/Users/Sarah/Desktop/WHOI/Microzooplankton/Date_bin_relational.xlsx")

Date_bin_relational <- rename(Date_bin_relational, bin = IFCB_ID)

Dated_bin_EP <- full_join(Date_bin_relational, bin_counts, by = "bin")

```

##the join did not appear to work, some of them that shoud match are not. 

try using other join types. want to keep all info from the bin_counts file, so try Ljoin with that one listed first? what is difference between l and r join if the order of dfs can be switched?


```{r}
LJ_bincounts_Dates <- left_join(bin_counts, Date_bin_relational, by = "bin")
```



